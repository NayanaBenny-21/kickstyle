<link rel="stylesheet" href="/css/profile.css">

<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
   <!-- Sidebar -->
      <div class="col-2 sidebar">
        <h4 class="mb-4 text-danger">KICKSTYLE</h4>
  <a href="/admin/dashboard" class="btn btn-danger w-100 mb-2">Dashboard</a>
  <a href="/admin/order-management" class="btn btn-danger w-100 mb-2">Orders</a>
  <a href="/admin/product-management" class="btn btn-danger w-100 mb-2">Products</a>
  <a href="/admin/sales-report" class="btn btn-danger w-100 mb-2">Sales Report</a>
  <a href="/admin/user-management" class="btn btn-danger w-100 mb-2">Customers</a>
  <a href="/admin/coupon-management" class="btn btn-danger w-100 mb-2 active">Coupons</a>
  <a href="/admin/category-management" class="btn btn-danger w-100 mb-2">Category</a>
    <a href="/admin/offer-management" class="btn btn-danger w-100 mb-2">Offers</a>


  <button class="btn w-100 mt-3" id="signout_btn" style="background-color: rgb(225, 227, 230);">
    Signout
  </button>
      </div>


    <div class="col-10 p-4">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="m-0">Coupons Management</h3>

        <div class="d-flex align-items-center gap-3">

          <!-- SEARCH -->
          <form id="searchForm" class="d-flex" style="width:300px;" method="GET">
            <input type="hidden" name="status" value="{{selectedStatus}}">
            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input 
                type="search" 
                name="search" 
                class="form-control" 
                placeholder="Search by name or code..." 
                value="{{search}}"
              >
            </div>
          </form>

          <!-- FILTER BUTTON -->
          <button class="btn btn-outline-secondary d-flex align-items-center gap-1" id="filterBtn" data-bs-toggle="modal" data-bs-target="#filterModal">
            <i class="bi bi-funnel"></i> Filter
          </button>

          <!-- ADD COUPON -->
          <a href="/admin/coupon/add" class="btn btn-danger d-flex align-items-center gap-1">
            <i class="bi bi-plus-lg"></i> Add
          </a>

        </div>
      </div>

      <hr style="height:6px">

      <!-- COUPON TABLE -->
      <table class="table table-bordered mt-4 text-center">
        <thead>
          <tr>
            <th>Name</th>
            <th>Coupon Code</th>
            <th>Discount</th>
            <th>Min Order</th>
            <th>Active From</th>
            <th>Active To</th>
            <th>Limit</th>
            <th>Used</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>
          {{#if coupons.length}}
            {{#each coupons}}
              <tr data-id="{{this._id}}">
                <td>{{this.couponName}}</td>
                <td>{{this.couponCode}}</td>
                <td>
                  {{#if (eq this.discountType "percentage")}}
                    {{this.discountValue}}%
                  {{else}}
                    ₹ {{this.discountValue}}
                  {{/if}}
                </td>
                <td>₹ {{this.minOrderAmount}}</td>
                <td>{{this.startDate}}</td>
                <td>{{this.expiryDate}}</td>
                <td>{{this.usageLimit}}</td>
                <td>{{this.usedCount}}</td>
                <td><span class="status-chip {{#if this.isActive}}active{{else}}blocked{{/if}}">{{#if this.isActive}}Active{{else}}Blocked{{/if}}</span></td>
                <td class="d-flex gap-2">
                            <label class="switch me-2">
            <input type="checkbox" class="toggle-status" data-id="{{this._id}}" {{#if this.isActive}}checked{{/if}}>
            <span class="slider"></span>
          </label>
                  <button class="btn btn-sm btn-outline-primary edit-btn" data-id="{{this._id}}">
                    <i class="bi bi-pencil-square"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger delete-btn" data-id="{{this._id}}">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            {{/each}}
          {{else}}
            <tr>
              <td colspan="10" class="text-center">No results found</td>
            </tr>
          {{/if}}
        </tbody>
      </table>

      <!-- PAGINATION -->
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">

          {{#if (gt currentPage 1)}}
          <li class="page-item">
            <a class="page-link" href="?page={{decrement currentPage 1}}&status={{selectedStatus}}&search={{search}}">
              Previous
            </a>
          </li>
          {{/if}}

          {{#each (range 1 totalPages)}}
          <li class="page-item {{#ifEquals ../currentPage this}}active{{/ifEquals}}">
            <a class="page-link" href="?page={{this}}&status={{../selectedStatus}}&search={{../search}}">
              {{this}}
            </a>
          </li>
          {{/each}}

          {{#if (lt currentPage totalPages)}}
          <li class="page-item">
            <a class="page-link" href="?page={{increment currentPage 1}}&status={{selectedStatus}}&search={{search}}">
              Next
            </a>
          </li>
          {{/if}}

        </ul>
      </nav>

    </div>
  </div>
</div>

<!-- Filter Modal -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-labelledby="filterModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="filterForm">
        <div class="modal-header">
          <h5 class="modal-title" id="filterModalLabel">Filter Coupons</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <!-- Status -->
          <div class="mb-3">
            <label>Status</label>
            <select class="form-select" name="status">
              <option value="">All</option>
              <option value="active">Active</option>
              <option value="inactive">Inactive</option>
            </select>
          </div>

          <!-- Discount Type -->
          <div class="mb-3">
            <label>Discount Type</label>
            <select class="form-select" name="discountType">
              <option value="">All</option>
              <option value="percentage">Percentage</option>
              <option value="flat">Flat</option>
            </select>
          </div>

          <!-- Date Range -->
          <div class="mb-3">
            <label>Start Date</label>
            <input type="date" name="startDate" class="form-control">
          </div>
          <div class="mb-3">
            <label>Expiry Date</label>
            <input type="date" name="expiryDate" class="form-control">
          </div>

        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Apply Filter</button>
        </div>
      </form>
    </div>
  </div>
</div>


<style>
  .status-chip {
    padding: 5px 12px;
    border-radius: 20px;
    font-size: 13px;
    font-weight: 600;
  }
  .status-chip.active {
    color: #2e7d32;
    border: 1px solid #2e7d32;
    background: #e6f4ea;
  }
  .status-chip.blocked {
    color: #c62828;
    border: 1px solid #c62828;
    background: #fde6e6;
  }
</style>
<script src="/js/admin/couponManagement.js"></script>