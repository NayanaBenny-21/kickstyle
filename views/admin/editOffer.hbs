<link rel="stylesheet" href="/css/style1.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css" />

<div class="container-fluid">
  <div class="row">
    {{> adminSidebar}}

    <div class="col-md-9 ms-auto p-4">
      <div class="card shadow-sm border-0 rounded-4 p-4 bg-white">

        <h4 class="mb-4 fw-bold text-danger">Edit Offer</h4>

        {{#if errors.global}}
        <div class="alert alert-danger">{{errors.global}}</div>
        {{/if}}

        <!-- ðŸ”´ IMPORTANT: novalidate -->
        <form
          action="/admin/offers/edit/{{offer._id}}"
          method="POST"
          id="offerForm"
          novalidate
        >
          <div class="row g-3">

            <!-- Offer Name -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Offer Name</label>
              {{#if errors.offerName}}
                <div class="invalid-feedback d-block">{{errors.offerName}}</div>
              {{/if}}
              <input
                type="text"
                name="offerName"
                class="form-control {{#if errors.offerName}}is-invalid{{/if}}"
                value="{{offer.offerName}}"
              >
            </div>

            <!-- Offer Type -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Offer Type</label>
              {{#if errors.offerType}}
                <div class="invalid-feedback d-block">{{errors.offerType}}</div>
              {{/if}}
              <select
                name="offerType"
                id="offerType"
                class="form-select {{#if errors.offerType}}is-invalid{{/if}}"
              >
                <option value="">Select</option>
                <option value="product" {{#ifEquals offer.offerType "product"}}selected{{/ifEquals}}>Product Offer</option>
                <option value="category" {{#ifEquals offer.offerType "category"}}selected{{/ifEquals}}>Category Offer</option>
              </select>
            </div>

            <!-- Discount Type -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Type</label>
              {{#if errors.discountType}}
                <div class="invalid-feedback d-block">{{errors.discountType}}</div>
              {{/if}}
              <select
                name="discountType"
                id="discountType"
                class="form-select {{#if errors.discountType}}is-invalid{{/if}}"
              >
                <option value="">Select</option>
                <option value="percentage" {{#ifEquals offer.discountType "percentage"}}selected{{/ifEquals}}>Percentage</option>
                <option value="flat" {{#ifEquals offer.discountType "flat"}}selected{{/ifEquals}}>Flat</option>
              </select>
            </div>

            <!-- Discount Value -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Discount Value</label>
              {{#if errors.discountValue}}
                <div class="invalid-feedback d-block">{{errors.discountValue}}</div>
              {{/if}}
              <input
                type="number"
                name="discountValue"
                id="discountValue"
                class="form-control {{#if errors.discountValue}}is-invalid{{/if}}"
                value="{{offer.discountValue}}"
              >
            </div>

            <!-- Product Section -->
            <div class="col-12 mb-3 {{#unless (eq offer.offerType 'product')}}d-none{{/unless}}" id="productSection">
              <label class="fw-semibold">Select Products</label>
              {{#if errors.products}}
                <div class="invalid-feedback d-block">{{errors.products}}</div>
              {{/if}}
              <select name="products[]" id="productSelect" class="form-select" multiple>
                {{#each products}}
                  <option
                    value="{{this._id}}"
                    {{#if (includes ../offer.products this._id)}}selected{{/if}}
                  >
                    {{this.product_name}} (â‚¹{{this.final_price}})
                  </option>
                {{/each}}
              </select>
            </div>

            <!-- Category Section -->
            <div class="col-12 mb-3 {{#unless (eq offer.offerType 'category')}}d-none{{/unless}}" id="categorySection">
              <label class="fw-semibold">Select Category</label>
              {{#if errors.category}}
                <div class="invalid-feedback d-block">{{errors.category}}</div>
              {{/if}}
              <select name="category" id="categorySelect" class="form-select">
                <option value="">Select Category</option>
                {{#each categories}}
                  <option
                    value="{{this._id}}"
                    {{#ifEquals this._id ../offer.category}}selected{{/ifEquals}}
                  >
                    {{this.category}}
                  </option>
                {{/each}}
              </select>
            </div>

            <!-- Dates -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Start Date</label>
              {{#if errors.startDate}}
                <div class="invalid-feedback d-block">{{errors.startDate}}</div>
              {{/if}}
              <input type="date" name="startDate" class="form-control" value="{{offer.startDateFormatted}}">
            </div>

            <div class="col-md-6">
              <label class="form-label fw-semibold">End Date</label>
              {{#if errors.endDate}}
                <div class="invalid-feedback d-block">{{errors.endDate}}</div>
              {{/if}}
              <input type="date" name="endDate" class="form-control" value="{{offer.endDateFormatted}}">
            </div>

            <!-- Status -->
            <div class="col-12 mt-3">
              <label class="form-label fw-semibold">Status</label>

              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="statusToggle"
                  {{#if offer.isActive}}checked{{/if}}
                >
                <label class="form-check-label">
                  <span id="statusLabel">
                    {{#if offer.isActive}}Active{{else}}Blocked{{/if}}
                  </span>
                </label>
              </div>

              <!-- Hidden value sent to backend -->
              <input
                type="hidden"
                name="isActive"
                id="isActiveInput"
                value="{{#if offer.isActive}}true{{else}}false{{/if}}"
              >
            </div>

            <!-- Buttons -->
            <div class="col-12 text-end mt-4">
              <a href="/admin/offer-management" class="btn btn-outline-secondary px-4">Cancel</a>
              <button type="submit" class="btn btn-danger px-4">Update</button>
            </div>

          </div>
        </form>

      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script src="/js/admin/editOffer.js"></script>
