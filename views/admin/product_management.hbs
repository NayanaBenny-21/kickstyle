<link rel="stylesheet" href="/css/profile.css">
<div class="container-fluid">
  <div class="row">

    <!-- Sidebar -->
   <!-- Sidebar -->
      <div class="col-2 sidebar">
        <h4 class="mb-4 text-danger">KICKSTYLE</h4>
  <a href="/admin/dashboard" class="btn btn-danger w-100 mb-2">Dashboard</a>
  <a href="/admin/order-management" class="btn btn-danger w-100 mb-2">Orders</a>
  <a href="/admin/product-management" class="btn btn-danger w-100 mb-2 active">Products</a>
  <a href="/admin/sales-report" class="btn btn-danger w-100 mb-2">Sales Report</a>
  <a href="/admin/user-management" class="btn btn-danger w-100 mb-2">Customers</a>
  <a href="/admin/coupon-management" class="btn btn-danger w-100 mb-2">Coupons</a>
  <a href="/admin/category-management" class="btn btn-danger w-100 mb-2">Category</a>
    <a href="/admin/offer-management" class="btn btn-danger w-100 mb-2">Offers</a>

  <button class="btn w-100 mt-3" id="signout_btn" style="background-color: rgb(225, 227, 230);">
    Signout
  </button>
      </div>


    <div class="col-10 p-4">

      <!-- Header -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="m-0">Product Management</h3>

        <div class="d-flex align-items-center gap-3">

          <!-- SEARCH -->
          <form id="searchForm" class="d-flex" style="width:300px;" method="GET">
            <input type="hidden" name="status" value="{{selectedStatus}}">
            <input type="hidden" name="category" value="{{selectedCategory}}">

            <div class="input-group">
              <span class="input-group-text"><i class="bi bi-search"></i></span>
              <input 
                type="search" 
                name="search" 
                class="form-control" 
                placeholder="Search..." 
                value="{{search}}"
              >
            </div>
          </form>

          <!-- FILTER BUTTON -->
          <button class="btn btn-outline-secondary d-flex align-items-center gap-1" id="filterBtn">
            <i class="bi bi-funnel"></i> Filter
          </button>

          <!-- ADD PRODUCT -->
          <a href="/admin/products/add" class="btn btn-danger d-flex align-items-center gap-1">
            <i class="bi bi-plus-lg"></i> Add
          </a>

        </div>
      </div>

      <hr style="height: 6px">

      <!-- PRODUCT TABLE -->
      <table class="table table-bordered mt-4">
        <thead>
          <tr>
            <th>Product</th>
            <th>Product ID</th>
            <th>Price</th>
            <th>Category</th>
            <th>Total Stock</th>
            <th>Added On</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
<tbody>
  {{#if products.length}}
    {{#each products}}
      <tr data-id="{{this._id}}">
        <td>{{this.product_name}}</td>
        <td>{{this._id}}</td>
        <td>{{this.base_price}}</td>
        <td>{{this.category_name}}</td>
        <td>{{this.total_stock}}</td>
        <td>{{this.formattedDate}}</td>
        <td><span class="status-badge {{this.statusClass}}">{{this.status}}</span></td>
        <td class="d-flex gap-2">
          <label class="switch me-2">
            <input type="checkbox" class="toggle-status" {{#if this.isActive}}checked{{/if}}>
            <span class="slider"></span>
          </label>
          <button class="btn btn-sm btn-outline-primary edit-btn" data-id="{{this._id}}">
            <i class="bi bi-pencil-square"></i>
          </button>
          <button class="btn btn-sm btn-outline-danger delete-btn" data-id="{{this._id}}">
            <i class="bi bi-trash"></i>
          </button>
        </td>
      </tr>
    {{/each}}
  {{else}}
    <tr>
      <td colspan="8" class="text-center">No results found</td>
    </tr>
  {{/if}}
</tbody>

      </table>

      <!-- PAGINATION -->
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">

          {{#if (gt currentPage 1)}}
          <li class="page-item">
            <a 
              class="page-link" 
              href="?page={{decrement currentPage 1}}&category={{selectedCategory}}&status={{selectedStatus}}&search={{search}}"
            >
              Previous
            </a>
          </li>
          {{/if}}

          {{#each (range 1 totalPages)}}
          <li class="page-item {{#ifEquals ../currentPage this}}active{{/ifEquals}}">
            <a 
              class="page-link" 
              href="?page={{this}}&category={{../selectedCategory}}&status={{../selectedStatus}}&search={{../search}}"
            >
              {{this}}
            </a>
          </li>
          {{/each}}

          {{#if (lt currentPage totalPages)}}
          <li class="page-item">
            <a
              class="page-link"
              href="?page={{increment currentPage 1}}&category={{selectedCategory}}&status={{selectedStatus}}&search={{search}}"
            >
              Next
            </a>
          </li>
          {{/if}}

        </ul>
      </nav>

    </div>
  </div>
</div>



<!-- FILTER MODAL -->
<div class="modal fade" id="filterModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Filter Products</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <form id="filterForm">

          <!-- CATEGORY -->
          <div class="mb-3">
            <label for="categoryFilter" class="form-label">Category</label>
            <select class="form-select" id="categoryFilter" name="category">
              <option value="">All</option>

              {{#each categories}}
              <option 
                value="{{this._id}}" 
                {{#ifEquals ../selectedCategory this._id}}selected{{/ifEquals}}
              >
                {{this.category}}
              </option>
              {{/each}}

            </select>
          </div>

          <!-- STATUS -->
          <div class="mb-3">
            <label for="statusFilter" class="form-label">Status</label>
            <select class="form-select" id="statusFilter" name="status">
              <option value="">All</option>
              <option value="Listed" {{#ifEquals selectedStatus "Listed"}}selected{{/ifEquals}}>Listed</option>
              <option value="Unlisted" {{#ifEquals selectedStatus "Unlisted"}}selected{{/ifEquals}}>Unlisted</option>
            </select>
          </div>

          <button type="submit" class="btn btn-primary w-100">Apply Filter</button>

        </form>
      </div>

    </div>
  </div>
</div>


<script>
function handleSearch(event) {
  const searchInput = document.getElementById('searchInput').value.trim();
  const form = event.target;
  if (!searchInput) {
    // Remove search from query parameters if empty
    const url = new URL(window.location.href);
    url.searchParams.delete('search');
    url.searchParams.delete('page'); // reset pagination
    window.location.href = url.toString();
    event.preventDefault();
  }
}
</script>
<script src="/js/admin/productManagement.js"></script>
      <script src="/js/sidebar.js"></script>