<div class="container-fluid my-5">

  <!-- CATEGORY TITLE -->
  <h4 class="fw-bold mb-4 text-capitalize">
    {{selectedCategory}} Collection
  </h4>

  <!-- SORT -->
  <div class="d-flex justify-content-end mb-3">
    <div class="sort-box bg-white border rounded shadow-sm px-3 py-2 d-inline-flex align-items-center">
      <label for="sortProducts" class="me-2 fw-bold mb-0" style="font-size:0.85rem;">Sort by:</label>
      <select id="sortProducts" class="form-select form-select-sm w-auto" style="min-width:120px; border:none;">
        <option value="">Select</option>
        <option value="priceLowHigh" {{#ifEquals sort "priceLowHigh"}}selected{{/ifEquals}}>Price: Low to High</option>
        <option value="priceHighLow" {{#ifEquals sort "priceHighLow"}}selected{{/ifEquals}}>Price: High to Low</option>
        <option value="newest" {{#ifEquals sort "newest"}}selected{{/ifEquals}}>Newest</option>
      </select>
    </div>
  </div>

  <div class="row">
    <!-- FILTER SIDEBAR -->
    <div class="col-md-2 sidebar">
      <h5 class="fw-bold">FILTERS</h5>
      <hr class="my-3" style="border: 0 !important; height: 3px!important; background-color: black !important;">

      <!-- Hidden input to hold category -->
      <input type="hidden" id="category" value="{{selectedCategory}}">

      <!-- BRAND -->
      <div class="mb-3">
        <h6 class="fw-bold"><small>BRAND</small></h6>
        {{#each brands}}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="brand" value="{{this}}"
              {{#if (includes ../selectedFilters.brand this)}}checked{{/if}}>
            <label class="form-check-label">{{this}}</label>
          </div>
        {{/each}}
      </div>

      <!-- COLOR -->
      <div class="mb-3">
        <h6 class="fw-bold"><small>COLOR</small></h6>
        {{#each colors}}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="color" value="{{this}}"
              {{#if (includes ../selectedFilters.color this)}}checked{{/if}}>
            <label class="form-check-label">{{this}}</label>
          </div>
        {{/each}}
      </div>

      <!-- SIZE -->
      <div class="mb-3">
        <h6 class="fw-bold"><small>SIZE</small></h6>
        {{#each sizes}}
          <div class="form-check">
            <input class="form-check-input" type="checkbox" name="size" value="{{this}}"
              {{#if (includes ../selectedFilters.size this)}}checked{{/if}}>
            <label class="form-check-label">{{this}}</label>
          </div>
        {{/each}}
      </div>

      <button class="btn btn-primary w-100" id="applyFilter" style="background:#de8024">
        Apply Filters
      </button>
    </div>

    <!-- PRODUCTS GRID -->
    <div class="col-md-10">
      <div class="row g-4">
        {{#if products.length}}
          {{#each products}}
            <div class="col-6 col-md-4 col-lg-3 mb-4">
              <a href="/product/{{this._id}}" class="text-decoration-none text-dark">
                <div class="card h-100 shadow-sm position-relative">

                  <!-- Wishlist -->
                  <button class="btn btn-light position-absolute top-0 end-0 m-2 wishlist-btn" data-product-id="{{this._id}}">
                    <i class="fa-regular fa-heart"></i>
                  </button>

                  <!-- Product Image -->
                  <img src="{{this.images.main}}" class="card-img-top" style="height: 300px; object-fit: cover;" alt="{{this.product_name}}">

                  <div class="card-body p-2">
                    <h6 class="card-title fw-bold mb-1">{{this.brand}}</h6>
                    <p class="mb-1" style="font-size: small;">{{this.product_name}}</p>
                    <div class="d-flex align-items-center mb-1" style="gap: 0.5rem;">
                      <p class="fw-bold mb-0" style="font-size: small;">₹{{this.final_price}}</p>
                      <p class="mb-0 text-muted" style="font-size: small;"><s>₹{{this.base_price}}</s></p>
                    </div>
                    {{#if this.discount_percentage}}
                      <span class="badge bg-danger">-{{this.discount_percentage}}%</span>
                    {{/if}}
                  </div>

                </div>
              </a>
            </div>
          {{/each}}
        {{else}}
          <p class="text-center text-muted">No products found.</p>
        {{/if}}
      </div>
    </div>
  </div>

  <!-- PAGINATION -->
  <nav aria-label="Page navigation">
    <ul class="pagination justify-content-center mt-4">
      {{#if (gt currentPage 1)}}
        <li class="page-item">
          <a class="page-link" href="?page={{decrement currentPage 1}}{{#if sort}}&sort={{sort}}{{/if}}">Previous</a>
        </li>
      {{/if}}

      {{#each (range 1 totalPages)}}
        <li class="page-item {{#ifEquals ../currentPage this}}active{{/ifEquals}}">
          <a class="page-link" href="?page={{this}}{{#if ../sort}}&sort={{../sort}}{{/if}}">{{this}}</a>
        </li>
      {{/each}}

      {{#if (lt currentPage totalPages)}}
        <li class="page-item">
          <a class="page-link" href="?page={{increment currentPage 1}}{{#if sort}}&sort={{sort}}{{/if}}">Next</a>
        </li>
      {{/if}}
    </ul>
  </nav>

</div>

<script src="/js/user/categoryProducts.js"></script>
<script src="/js/user/wishlist.js"></script>
