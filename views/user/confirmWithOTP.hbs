<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<div class="otp-box">
    <h5 class="fw-bold">Confirm with OTP</h5>
    <p class="text-muted mb-3">
        Please enter the OTP sent to your email.
    </p>
    {{#if error}}
    <p class="text-danger">{{error}}</p>
    {{/if}}
    <form id="loginOtpForm">
    <input type="hidden" name="email" value="{{email}}">
    <div class="d-flex justify-content-center mb-3 gap-2">
      <input type="text" inputmode="numeric" maxlength="1" name="otp1" class="otp-input" required>
      <input type="text" inputmode="numeric" maxlength="1" name="otp2" class="otp-input" required>
      <input type="text" inputmode="numeric" maxlength="1" name="otp3" class="otp-input" required>
      <input type="text" inputmode="numeric" maxlength="1" name="otp4" class="otp-input" required>
    </div>
<p id="otpError" class="text-danger mb-2" style="display:none;"></p>

        <p class="text-danger small mb-2" id="timer" style = "display: none;"></p>
        <button id="resend" type="button" style="display:none">Resend OTP</button>

        <div class="d-flex justify-content-center mb-3">
            <button class="btn btn-danger w-50">Confirm</button>
        </div>
    </form>
    <div>
        <a href="/auth/login" class="back-link">‚Üê Back to Login Page</a>
    </div>
</div>

<script>
    window.otpSent = {{#if otpSent}}true{{else}}false{{/if}};
    window.remainingTime = {{#if remainingTime}}{{remainingTime}}{{else}}0{{/if}};
    window.otpSuccess = {{#if otpSuccess}}true{{else}}false{{/if}};
    window.showToast = {{#if showToast}}true{{else}}false{{/if}};

    console.log("DEBUG: window.otpSent =", window.otpSent);
    console.log("DEBUG: window.remainingTime =", window.remainingTime);
    console.log("DEBUG: window.otpSuccess =", window.otpSuccess);
    console.log("DEBUG: window.showToast =", window.showToast);
</script>

<script src="/js/user/login_otp.js"></script>
<script>
    console.log("otpSent:", window.otpSent, "remainingTime:", window.remainingTime, "otpSuccess:", window.otpSuccess);

    if (window.otpSuccess) {
        setTimeout(() => {
            Swal.fire({
                icon: "success",
                text: "Logged Successfully!",
                toast: true,
                position: "bottom",
                timer: 2500,
                showConfirmButton: false,
                width: 350,
                padding: '0.5em 1em',
                customClass: { popup: 'small-toast' }
            }).then(() => {
                window.location.href = '/';
            });
        }, 100); 
    }
</script>
